<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Quality Dashboard</title>
  <link rel="stylesheet" href="styles.css"> <!-- Link to external CSS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Chart.js Library -->
</head>

<body>
  <h1>NUTRITIONISTSCORE</h1>
  <table id="productTable">
    <tr>
      <th>Product Name</th>
      <th>Vitamin & Minerals</th>
      <th>Ripeness Level</th>
      <th>Microbial Quality</th>
      <th>Taste Quality</th>
      <th>Aroma Quality</th>
      <th>Colour Quality</th>
      <th>Actions</th>
    </tr>
    <!-- Predefined products -->
    <tr>
      <td>Carrot</td>
      <td>8</td>
      <td>9</td>
      <td>7</td>
      <td>8</td>
      <td>7</td>
      <td>8</td>
      <td>
        <button class="btn btn-edit" onclick="editRow(this)">Edit</button>
        <button class="btn btn-delete" onclick="deleteRow(this)">Delete</button>
        <button class="btn btn-view" onclick="viewChart(this)">View</button>
      </td>
    </tr>
    <tr>
      <td>Capsicum</td>
      <td>7</td>
      <td>8</td>
      <td>8</td>
      <td>9</td>
      <td>8</td>
      <td>7</td>
      <td>
        <button class="btn btn-edit" onclick="editRow(this)">Edit</button>
        <button class="btn btn-delete" onclick="deleteRow(this)">Delete</button>
        <button class="btn btn-view" onclick="viewChart(this)">View</button>
      </td>
    </tr>
    <tr>
      <td>Broccoli</td>
      <td>9</td>
      <td>8</td>
      <td>7</td>
      <td>8</td>
      <td>9</td>
      <td>8</td>
      <td>
        <button class="btn btn-edit" onclick="editRow(this)">Edit</button>
        <button class="btn btn-delete" onclick="deleteRow(this)">Delete</button>
        <button class="btn btn-view" onclick="viewChart(this)">View</button>
      </td>
    </tr>
    <tr>
      <td>Spinach</td>
      <td>9</td>
      <td>9</td>
      <td>8</td>
      <td>9</td>
      <td>8</td>
      <td>9</td>
      <td>
        <button class="btn btn-edit" onclick="editRow(this)">Edit</button>
        <button class="btn btn-delete" onclick="deleteRow(this)">Delete</button>
        <button class="btn btn-view" onclick="viewChart(this)">View</button>
      </td>
    </tr>
    <tr>
      <td>Cucumber</td>
      <td>8</td>
      <td>7</td>
      <td>9</td>
      <td>8</td>
      <td>9</td>
      <td>7</td>
      <td>
        <button class="btn btn-edit" onclick="editRow(this)">Edit</button>
        <button class="btn btn-delete" onclick="deleteRow(this)">Delete</button>
        <button class="btn btn-view" onclick="viewChart(this)">View</button>
      </td>
    </tr>
  </table>
  <button onclick="addRow()">Add Row</button>

  <!-- Bar Chart Section -->
  <div style="width: 80%; margin: 20px auto; display: none;" id="chartContainer">
    <canvas id="productChart"></canvas>
  </div>

  <script>
    let chartInstance; // Global variable for the chart instance

    // Function to delete a row
    function deleteRow(button) {
      const row = button.parentElement.parentElement;
      row.remove();
    }

    // Function to edit a row
    function editRow(button) {
      const row = button.parentElement.parentElement;
      const cells = row.querySelectorAll("td:not(:last-child)");

      cells.forEach(cell => {
        const currentValue = cell.innerHTML;
        const input = document.createElement("input");
        input.type = "text";
        input.value = currentValue;
        cell.innerHTML = "";
        cell.appendChild(input);
      });

      button.innerHTML = "Save";
      button.onclick = function () {
        saveRow(this);
      };
    }

    // Function to save an edited row
    function saveRow(button) {
      const row = button.parentElement.parentElement;
      const inputs = row.querySelectorAll("td input");

      inputs.forEach(input => {
        const cell = input.parentElement;
        cell.innerHTML = input.value;
      });

      button.innerHTML = "Edit";
      button.onclick = function () {
        editRow(this);
      };
    }

    // Function to add a new row
    function addRow() {
      const table = document.getElementById("productTable");
      const row = table.insertRow(-1);
      const cells = ["", "", "", "", "", "", "", ""];

      cells.forEach((_, index) => {
        const cell = row.insertCell(index);
        if (index === 7) {
          cell.innerHTML = `
            <button class="btn btn-edit" onclick="editRow(this)">Edit</button>
            <button class="btn btn-delete" onclick="deleteRow(this)">Delete</button>
            <button class="btn btn-view" onclick="viewChart(this)">View</button>
          `;
        } else {
          cell.innerHTML = `<input type="text" placeholder="Enter value">`;
        }
      });
    }

    // Function to view a specific bar chart
    function viewChart(button) {
      const row = button.parentElement.parentElement;
      const cells = row.querySelectorAll("td:not(:last-child)");

      const labels = [
        "Vitamin & Minerals",
        "Ripeness Level",
        "Microbial Quality",
        "Taste Quality",
        "Aroma Quality",
        "Colour Quality",
      ];

      // Extract numeric values from the row
      const data = Array.from(cells)
        .slice(1) // Skip the first cell (Product Name)
        .map(cell => parseFloat(cell.innerText) || 0); // Use 0 if the value is not a number

      const productName = cells[0].innerText; // First cell contains the product name

      const ctx = document.getElementById("productChart").getContext("2d");
      document.getElementById("chartContainer").style.display = "block";

      // Destroy the previous chart instance if it exists
      if (chartInstance) {
        chartInstance.destroy();
      }

      // Create a new chart
      chartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: `Quality Metrics for ${productName}`,
            data: data,
            backgroundColor: [
              'rgba(255, 99, 132, 0.6)',
              'rgba(54, 162, 235, 0.6)',
              'rgba(255, 206, 86, 0.6)',
              'rgba(75, 192, 192, 0.6)',
              'rgba(153, 102, 255, 0.6)',
              'rgba(255, 159, 64, 0.6)'
            ],
            borderColor: [
              'rgba(255, 99, 132, 1)',
              'rgba(54, 162, 235, 1)',
              'rgba(255, 206, 86, 1)',
              'rgba(75, 192, 192, 1)',
              'rgba(153, 102, 255, 1)',
              'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
  </script>
</body>

</html>